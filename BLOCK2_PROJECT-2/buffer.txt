select a.name area, count(*) cnt from areas a join vacancies v on a.id = v.area_id group by area order by cnt desc limit 5
select count(*) not_empty_salary from vacancies where salary_from  is not null or salary_to is not null
select round(avg(salary_from)) avg_min_salary, round(avg(salary_to)) avg_max_salary from vacancies
select schedule, employment, count(*)  from vacancies group by 1, 2 order by 3 desc offset 1 limit 1
select experience, count(*) from vacancies group by 1 order by 2

(select e.name company_name, count(v.id) company_vacancies from employers e join vacancies v on e.id = v.employer_id group by 1 order by 2 desc limit 1)
union
(select e.name, count(v.id) cnt from employers e join vacancies v on e.id = v.employer_id group by 1 order by 2 desc offset 4 limit 1)
order by company_vacancies desc

select a.name, count(e.id) employers_cnt, count(v.id) vacancies_cnt
from areas a 
join employers e on a.id = e.area
left join vacancies v on a.id = v.area_id
group by 1 order by  3, 2 desc 
limit 1

select employer_id, count(salary_to), count(distinct salary_to), count(*) from vacancies group by 1
select id, employer_id, salary_to from vacancies where employer_id = 522


select count(distinct area_id) max_cnt from vacancies group by employer_id order by 1 desc limit 1

select count(distinct e.id), count(e.id), count(*) from employers e left join employers_industries ei on e.id = ei.employer_id where ei.employer_id is null
select count(*) from employers

select count(*) from employers where id not in (select employer_id from employers_industries)

select e.name, count(distinct ei.industry_id) ind_cnt
from employers e  join employers_industries ei on e.id = ei.employer_id
group by e.name
having count(distinct ei.industry_id) = 4
order by e.name
offset 2 limit 1

select count(distinct ei.employer_id) emp_dev_po from employers_industries ei join industries i on ei.industry_id = i.id where i.name = 'Разработка программного обеспечения'

select a.name "name" from areas a

(
select a.name "name", count(*) cnt from areas a
join vacancies v on a.id = v.area_id
join employers e on e.id = v.employer_id
where a.name in (
	'Москва', 'Санкт-Петербург', 'Новосибирск', 'Екатеринбург', 'Казань', 'Нижний Новгород',
	'Челябинск', 'Красноярск', 'Самара', 'Уфа', 'Ростов-на-Дону', 
	'Омск', 'Краснодар', 'Воронеж', 'Пермь', 'Волгоград'
	)
	and
	e.name = 'Яндекс'
group by a.name
order by cnt 
)
union
(
select 'Total' "name", count(*) cnt from areas a
join vacancies v on a.id = v.area_id
join employers e on e.id = v.employer_id
where a.name in (
	'Москва', 'Санкт-Петербург', 'Новосибирск', 'Екатеринбург', 'Казань', 'Нижний Новгород',
	'Челябинск', 'Красноярск', 'Самара', 'Уфа', 'Ростов-на-Дону', 
	'Омск', 'Краснодар', 'Воронеж', 'Пермь', 'Волгоград'
	)
	and
	e.name = 'Яндекс'
)

select count(*) ds_count from vacancies where lower(name) like '%data%' or lower(name) like '%данн%'

select *  from vacancies

select count(*) junior_cnt from vacancies
where 
(
lower(name) like '%data scientist%' or
lower(name) like '%data science%' or
lower(name) like '%исследователь данных%' or
(name like '%ML%' and name not like '%HTML%') or
lower(name) like '%machine learning%' or
lower(name) like '%машинн%обучен%%'
) and (
lower(name) like '%junior%' or
experience = 'Нет опыта' or
employment = 'Стажировка'
)

select count(*) ds_and_db_cnt from vacancies
where 
(
lower(name) like '%data scientist%' or
lower(name) like '%data science%' or
lower(name) like '%исследователь данных%' or
(name like '%ML%' and name not like '%HTML%') or
lower(name) like '%machine learning%' or
lower(name) like '%машинн%обучен%%'
) and (
upper(key_skills) like '%SQL%' or
lower(key_skills) like '%postgres%'
)

select count(*) ds_and_python_cnt from vacancies
where 
(
lower(name) like '%data scientist%' or
lower(name) like '%data science%' or
lower(name) like '%исследователь данных%' or
(name like '%ML%' and name not like '%HTML%') or
lower(name) like '%machine learning%' or
lower(name) like '%машинн%обучен%%'
) and (
lower(key_skills) like '%python%'
)

select length(key_skills) from vacancies

select avg(
1 + length(key_skills) - length(replace(key_skills, chr(9), ''))  
) ds_key_skills_cnt from vacancies
where 
(
lower(name) like '%data scientist%' or
lower(name) like '%data science%' or
lower(name) like '%исследователь данных%' or
(name like '%ML%' and name not like '%HTML%') or
lower(name) like '%machine learning%' or
lower(name) like '%машинн%обучен%%'
) and (
key_skills is not null
)


select round(avg(
(coalesce(salary_from, salary_to) + coalesce(salary_to, salary_from)) / 2
)) ds_avg_salary  from vacancies
where 
(
lower(name) like '%data scientist%' or
lower(name) like '%data science%' or
lower(name) like '%исследователь данных%' or
(name like '%ML%' and name not like '%HTML%') or
lower(name) like '%machine learning%' or
lower(name) like '%машинн%обучен%%'
) and (
experience = 'От 3 до 6 лет' and (salary_to is not null or salary_from is not null)
)